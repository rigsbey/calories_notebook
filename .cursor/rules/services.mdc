---
globs: services/*.py
---

# Сервисы проекта

## Структура сервиса:
- Каждый сервис - отдельный класс
- Инициализация API ключей в __init__
- Асинхронные методы для API вызовов
- Обработка ошибок с логированием
- Возврат понятных сообщений об ошибках

## Gemini Service:
- Использует прямые HTTP запросы через aiohttp
- Поддерживает анализ с указанным весом и автоопределением веса
- Коррекция анализа на основе пользовательского ввода
- Base64 кодирование изображений
- Таймауты для HTTP запросов (30 секунд)

## Google Calendar Service:
- OAuth2 авторизация
- Создание событий с информацией о питании
- Обработка ошибок авторизации

## Хранение анализов:
- Временное хранение для возможности редактирования
- Очистка старых записей
- Связь с пользователем через user_id

## Обработка изображений:
- Поддержка JPEG и PNG форматов
- Автоматическое определение MIME типа
- Кодирование в base64 для API